{% extends "base.html" %}
{% block content %}

<div id="container">
    <h1>Welcome to BounceHouse!</h1>

    <div id="gConnect">
    	<!-- 
    		The data-scope attribute indicates the access to a users data the app requires
    		The data-requestvisibleactions attribute defines the type of moments the app is requesting to write
    		The callback function handles the result of the authorization. 
    	-->
        <button class="g-signin"
            data-scope="https://www.googleapis.com/auth/plus.login"
            data-requestvisibleactions="http://schemas.google.com/AddActivity"
            data-clientId="{{ CLIENT_ID }}"
            data-accesstype="offline"
            data-callback="onSignInCallback"
            data-theme="dark"
            data-cookiepolicy="single_host_origin">
        </button>
    </div>
    <div id="connected" class="not_visible">
        <div>
            <h4>Google +</h4>
            <a href="/moment">
                <button id="gmoment" class="btn btn-primary">Insert a moment</button>
            </a>
            <button id="gdisconnect" class="btn">Sign out</button>
        </div>
        <div>
            <h4>Facebook</h4>
            <button class="btn btn-primary">Post to graph</button>
            <button class="btn">Sign out</button>
        </div>
        <div>
            <h4>Twitter</h4>
            <button class="btn btn-primary">Upload a photo</button>
            <button class="btn">Sign out</button>
        </div>
    </div>
</div>

<script type = "text/javascript">

    var authResult = undefined;

    function onSignInCallback(authResult) {
      if (authResult['access_token']) {     // the user is signed in
        console.log(authResult);

        // Hide the sign-in button
        $('#gConnect').hide('slow');

        this.authResult = authResult;
        connectServer();
      } else {
        console.log('Sign-in state: ' + authResult['error']);
      }
    }

    function connectServer() {
        console.log(authResult.code);
        // Ajax is a group of web development techniques used on the client-side
        // It creates asynchronous Web Applications 
        // They can send and retrieve data in background without interfering with the existing page
        $.ajax({
            type: 'POST',
            // the url to which the request is sent
            url: window.location.href + 'connect',
            // what is this?
            contentType: 'application/octet-stream; charset=utf-8',
            // a function to call if the request succeeds
            success: function(result) {                         
              console.log(result);
              $('#connected').show();
            },
            // prevents data from being transformed into a query string
            processData: false,
            // data to be sent to the server
            data: this.authResult.code
        });
    }

    function disconnectServer() {
        // redisplay the sign-in button
        $('#gConnect').show('slow');
        $('#connected').hide('slow');

        $.ajax({
            type: 'POST',
            url: window.location.href + 'disconnect',
            async: false,
            success: function(result) {
                console.log('revoke response: ' + result);
            },
            error: function(e) {
                console.log(e);
            }
        });
    }

    $(document).ready(function() {
        $('#gdisconnect').click(disconnectServer);
    });
</script>

{% endblock %}